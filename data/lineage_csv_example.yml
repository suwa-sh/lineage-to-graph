# CSV-based lineage example
# Model definitions are loaded from CSV files in data/レイアウト and data/テーブル定義

spec: lineage-v1

# models section is optional when using CSV files
models: []

lineage:
  # HTTP Request → Transaction Entity
  - { from: HttpRequest.request_id, to: TransactionEntity.transactionId }
  - { from: HttpRequest.user_id, to: TransactionEntity.userId }
  - { from: HttpRequest.amount, to: TransactionEntity.amount }
  - { from: HttpRequest.timestamp, to: TransactionEntity.createdAt, transform: "parse as timestamp" }

  # Transaction Entity → RDB Table
  - { from: TransactionEntity.transactionId, to: transactions.transaction_id }
  - { from: TransactionEntity.userId, to: transactions.user_id }
  - { from: TransactionEntity.amount, to: transactions.amount }
  - { from: TransactionEntity.createdAt, to: transactions.created_at }

  # Aggregate to balance snapshot
  - { from: transactions.user_id, to: balance_snapshot.user_id }
  - { from: transactions.amount, to: balance_snapshot.total_amount, transform: "sum by user_id" }
  - { from: now(), to: balance_snapshot.last_updated, transform: "current timestamp" }
